jQuery.fn.waDialog=function(a){a=jQuery.extend({loading_header:"",title:"",esc:true,buttons:null,url:null,"class":null,content:null,width:0,height:0,"min-width":0,"min-height":0,disableButtonsOnSubmit:false,onLoad:null,onCancel:null,onSubmit:null},a||{});var b=$(this),d=b.attr("id");if(d&&!b.hasClass("dialog")){b.removeAttr("id");$("#"+d).remove()}var f=a["class"]||a.className?a["class"]||a.className:b.attr("class");if(b.hasClass("dialog")){if(a.content){b.find(".dialog-content-indent").html(a.content);
a.title&&b.find(".dialog-content-indent").prepend("<h1>"+a.title+"</h1>")}a.buttons&&b.find(".dialog-buttons-gradient").empty().append(a.buttons)}else{var e=$(this);b=$("<div "+(d?'id = "'+d+'"':"")+' class="dialog '+f+'" style="display: none"><div class="dialog-background"></div><div class="dialog-window"></div></div>').appendTo("body");if(e.find(".dialog-content").length||e.find(".dialog-buttons").length){$(".dialog-window",b).append(e.show());d=e.find(".dialog-content");if(d.length){f=$('<div class="dialog-content-indent"></div>');
d.contents().appendTo(f);d.append(f)}d=e.find(".dialog-buttons");if(d.length){f=$('<div class="dialog-buttons-gradient"></div>');d.contents().appendTo(f);d.append(f)}}else{$(".dialog-window",b).append((a.onSubmit?'<form method="post" action="">':"")+'<div class="dialog-content"><div class="dialog-content-indent"></div></div><div class="dialog-buttons"><div class="dialog-buttons-gradient"></div></div>'+(a.onSubmit?"</form>":""));b.find(".dialog-content-indent").append(e.show())}a.buttons&&b.find(".dialog-buttons-gradient").empty().append(a.buttons);
if(a.url)b.find(".dialog-content-indent").append("<h1>"+(a.loading_header||"")+'<i class="icon16 loading"></i></h1>');else a.content&&b.find(".dialog-content-indent").append(a.content);a.title&&b.find(".dialog-content-indent").prepend("<h1>"+a.title+"</h1>")}b.find(".dialog-background").length||b.prepend('<div class="dialog-background"> </div>');b.bind("close",function(){a.onClose&&a.onClose.call($(this));$(this).hide()});e=["width","height","min-width","min-height"];for(d=0;d<e.length;d++)if(a[e[d]]){if(e[d]==
"height"&&a[e[d]]<"300px"||e[d]=="width"&&a[e[d]]<"400px")b.find("div.dialog-window").css("min-"+e[d],a[e[d]]);b.find("div.dialog-window").css(e[d],a[e[d]])}a.disableButtonsOnSubmit&&b.find("input[type=submit]").removeAttr("disabled");b.parent().length||b.appendTo("body");b.show();if(a.url)jQuery.get(a.url,function(c){var g=$(c);if(g.find(".dialog-content").length||g.find(".dialog-buttons").length){g.find(".dialog-content").length&&b.find(".dialog-content-indent").empty().append(g.find(".dialog-content").contents());
g.find(".dialog-buttons").length&&b.find(".dialog-buttons-gradient").empty().append(g.find(".dialog-buttons").contents())}else b.find(".dialog-content-indent").html(c);b.trigger("wa-resize");a.onLoad&&a.onLoad.call(b.get(0))});else a.onLoad&&a.onLoad.call(b.get(0));b.find(".dialog-buttons").delegate(".cancel","click",function(c){c.stopPropagation();c.preventDefault();a.onCancel&&a.onCancel.call(b.get(0));b.trigger("close");return false});a.onSubmit&&b.find("form").unbind("submit").submit(function(){a.disableButtonsOnSubmit&&
b.find("input[type=submit]").attr("disabled","disabled");return a.onSubmit.apply(this,[b])});b.bind("wa-resize",function(){var c=jQuery(this).find(".dialog-window"),g=c.width(),h=c.height();jQuery("body").css("min-height",h+"px");var k=jQuery(window).width(),j=jQuery(window).height()-60;g=(k-g)/2/k;h=(j-h-60)/2/j;if(h<0)h=0;if(g<0)g=0;c.css({left:Math.round(g*100)+"%",top:Math.round(h*100)+"%"})}).trigger("wa-resize");a.esc&&b.bind("esc",function(){b.trigger("close")});return b};jQuery(window).resize(function(){jQuery(".dialog:visible").trigger("wa-resize")});
jQuery(document).keyup(function(a){a.keyCode==27&&jQuery(".dialog:visible").trigger("esc")});/*
 GNU Affero General Public License - {@link http://www.gnu.org/licenses/agpl.html}
 @example Visit {@link http://jquery.com/plugins/project/jquery_history_bal} for more information.


 I would like to take this space to thank the following projects, blogs, articles and people:
 - jQuery {@link http://jquery.com/}
 - jQuery UI History - Klaus Hartl {@link http://www.stilbuero.de/jquery/ui_history/}
 - Really Simple History - Brian Dillard and Brad Neuberg {@link http://code.google.com/p/reallysimplehistory/}
 - jQuery History Plugin - Taku Sano (Mikage Sawatari) {@link http://www.mikage.to/jquery/jquery_history.html}
 - jQuery History Remote Plugin - Klaus Hartl {@link http://stilbuero.de/jquery/history/}
 - Content With Style: Fixing the back button and enabling bookmarking for ajax apps - Mike Stenhouse {@link http://www.contentwithstyle.co.uk/Articles/38/fixing-the-back-button-and-enabling-bookmarking-for-ajax-apps}
 - Bookmarks and Back Buttons {@link http://ajax.howtosetup.info/options-and-efficiencies/bookmarks-and-back-buttons/}
 - Ajax: How to handle bookmarks and back buttons - Brad Neuberg {@link http://dev.aol.com/ajax-handling-bookmarks-and-back-button}



 CHANGELOG

 v1.0.1-final, July 11, 2009
 - Restructured a little bit
 - Documented
 - Cleaned go/request

 v1.0.0-final, June 19, 2009
 - Been stable for over a year now, pushing live.

 v0.1.0-dev, July 24, 2008
 - Initial Release

*/
(function(a){if(typeof console==="undefined")console=typeof window.console!=="undefined"?window.console:{};console.log=console.log||function(){};console.debug=console.debug||console.log;console.warn=console.warn||console.log;console.error=console.error||function(){for(var b=[],d=0;d<arguments.length;d++)b.push(arguments[d]);alert(b.join("\n"))};console.trace=console.trace||console.log;console.group=console.group||console.log;console.groupEnd=console.groupEnd||console.log;console.profile=console.profile||
console.log;console.profileEnd=console.profileEnd||console.log;a.History={options:{debug:false},state:"",$window:null,$iframe:null,handlers:{generic:[],specific:{}},format:function(b){return b=b.replace(/^.+?#/g,"").replace(/^#?\/?|\/?$/g,"")},getState:function(){return a.History.state},setState:function(b){var d=a.History;b=d.format(b);d.state=b;return d.state},getHash:function(){var b=parent&&!a.browser.msie?parent.window.location.hash:window.location.hash||location.hash;return b=a.History.format(b)},
setHash:function(b){b=a.History.format(b);b=b.replace(/^\/?|\/?(\?)|\/?$/g,"/$1");if(typeof window.location.hash==="undefined")location.hash=b;if(a.browser.msie&&parseInt(a.browser.version,10)<8){a.History.$iframe.contentWindow.document.open();a.History.$iframe.contentWindow.document.close()}},go:function(b){var d=a.History;b=d.format(b);if(d.getHash()!==b)d.setHash(b);else{d.setState(b);d.trigger()}return true},hashchange:function(){var b=a.History;b.options.debug&&console.debug("History.hashchange",
this,arguments);var d=b.getHash(),f=b.getState();if(!b.$iframe&&f===d||b.$iframe&&b.hash===b.$iframe.contentWindow.document.location.hash)return false;if(f===d)return false;b.setState(d);b.trigger();return true},bind:function(b,d){var f=a.History;if(d){if(typeof f.handlers.specific[b]==="undefined")f.handlers.specific[b]=[];f.handlers.specific[b].push(d)}else{d=b;f.handlers.generic.push(d)}return true},trigger:function(b){var d=a.History;if(typeof b==="undefined")b=d.getState();var f,e,c,g;if(typeof d.handlers.specific[b]!==
"undefined"){g=d.handlers.specific[b];f=0;for(e=g.length;f<e;++f){c=g[f];c(b)}}g=d.handlers.generic;f=0;for(e=g.length;f<e;++f){c=g[f];c(b)}return true},construct:function(){var b=a.History;a(document).ready(function(){b.domReady()});return true},configure:function(b){var d=a.History;d.options=a.extend(d.options,b);return true},domReadied:false,domReady:function(){var b=a.History;if(!b.domRedied){b.domRedied=true;b.$window=a(window);b.$window.bind("hashchange",this.hashchange);setTimeout(b.hashchangeLoader,
200);return true}},hashchangeLoader:function(){var b=a.History;if(a.browser.msie&&parseInt(a.browser.version)>=8)(d=b.getHash())&&b.$window.trigger("hashchange");else{if(a.browser.msie){b.$iframe=a('<iframe id="jquery-history-iframe" style="display: none;"></$iframe>').prependTo(document.body)[0];b.$iframe.contentWindow.document.open();b.$iframe.contentWindow.document.close();var d=b.getHash();if(d)b.$iframe.contentWindow.document.location.hash=d;d=function(){var f=b.format(b.$iframe.contentWindow.document.location.hash);
b.getState()!==f&&b.setHash(b.$iframe.contentWindow.document.location.hash);f=b.getHash();b.getState()!==f&&b.go(f)}}else d=function(){var f=b.getHash();b.getState()!==f&&b.go(f)};a.browser.msie&&parseInt(a.browser.version)<8?setInterval(d,1500):setInterval(d,200)}return true}};a.History.construct()})(jQuery);$.wa=$.ui?$.extend(true,$.wa,$.ui):{};
$.wa=$.extend(true,$.wa,{data:{},get:function(a,b){if(a==undefined)return this.data;return this.data[name]||b||null},set:function(a){if(a==undefined)return this.data;if(typeof a=="object")$.extend(this.data,a);else this.data[a]=value;return this.data},encodeHTML:function(a){return a&&(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},decodeHTML:function(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},setHash:function(a){if(!(a instanceof String)&&
a.toString)a=a.toString();a=a.replace(/\/\//g,"/");a=a.replace(/^.*#/,"");if(parent&&!$.browser.msie)parent.window.location.hash=a;else location.hash=a;return true},back:function(a){if(history.length>2)typeof a=="number"&&parseInt(a)==a?history.go(-a):history.go(-1);else if($.browser.msie&&history.length>0)history.back();else a&&this.setHash(a);return false},toggleHashParam:function(a){location.hash.search(a)==-1?this.addToHash(a):this.removeFromHash(a)},addToHash:function(a){var b=location.hash;
if(b.search(a)==-1)b+="/"+a+"/";this.setHash(b)},removeFromHash:function(a){var b=location.hash;if(b.search(a)>-1)b=b.replace(a,"");this.setHash(b)},setTitle:function(a){document.title=a},array_search:function(a,b,d){d=!!d;for(var f in b)if(d&&b[f]===a||!d&&b[f]==a)return f;return false},dialogCreate:function(a,b){b=$.extend({content:'<h1>Loading... <i class="icon16 loading"></i></h1>',buttons:null,url:null,post:null,small:false,onload:null,oncancel:null},b);b.content=$(b.content);b.buttons=b.buttons?
$(b.buttons):$('<input type="submit" class="button gray" value="'+$_("Cancel")+'">').click(function(){b.oncancel&&b.oncancel.call(d[0]);$.wa.dialogHide()});var d=$("#"+a);if(d.size()<=0)d=$('<div class="dialog" id="'+a+'" style="display: none"><div class="dialog-background"></div><div class="dialog-window"><div class="dialog-content"><div class="dialog-content-indent"></div></div><div class="dialog-buttons"><div class="dialog-buttons-gradient"></div></div></div></div>').appendTo("body");d.find(".dialog-buttons-gradient").empty().append(b.buttons);
d.find(".dialog-content-indent").empty().append(b.content);d.show();b.small?d.addClass("small"):d.removeClass("small");if(b.url){var f=function(c){d.find(".dialog-content-indent").html(c);$.wa.waCenterDialog(d);b.onload&&b.onload.call(d[0])};b.post?$.post(b.url,b.post,f):$.get(b.url,f)}this.waCenterDialog(d);var e=function(c){if(d.is(":visible"))if(c&&c.keyCode==27){b.oncancel&&typeof b.oncancel=="function"&&b.oncancel.call(d[0]);$.wa.dialogHide()}else $(document).one("keyup",e)};e();$(document).one("hashchange",
$.wa.dialogHide);return d},waCenterDialog:function(a){a=$(a);a=a.find(".dialog-window");var b=a.outerWidth(true),d=a.outerHeight(true),f=$(window).width(),e=$(window).height();a.css({left:Math.round((f-b)/2/f*100)+"%",top:Math.round((e-d)/2/e*100)+"%"})},dialogHide:function(){$(".dialog").hide();return false},dropdownsClose:function(){var a=$(".dropdown:not(.disabled)");a.addClass("disabled");setTimeout(function(){a.removeClass("disabled")},600)},dropdownsCloseEnable:function(){$(".dropdown:not(.disabled)").live("click",
this.dropdownsClickHandler)},dropdownsCloseDisable:function(){$(".dropdown:not(.disabled)").die("click",this.dropdownsClickHandler)},dropdownsClickHandler:function(){var a=$(this);if(!a.hasClass("no-click-close")){a.addClass("disabled");setTimeout(function(){a.removeClass("disabled")},600)}},defaultInputValue:function(a,b,d){a instanceof jQuery||(a=$(a));var f=function(){var e=a.val();if(!e||e==b){a.val(b);a.addClass(d)}};f();a.blur(f);a.focus(function(){if(a.hasClass(d)){a.removeClass(d);a.val("")}})},
util:{formatFileSize:function(a){var b=-1;do{a/=1024;b++}while(a>99);return Math.max(a,0.01).toFixed(2)+(b>=0?" "+$_(["kB","MB","GB","TB","PB","EB"][b]):"")}}});
$(document).ajaxError(function(a,b){if(b.status!==200&&b.responseText){if(!$.wa.errorHandler||$.wa.errorHandler(b))if(b.responseText.indexOf("Exception")!=-1)$.wa.dialogCreate("ajax-error",{content:"<div>"+b.responseText+"</div>"});else{document.open("text/html");document.write(b.responseText);document.close();$(window).one("hashchange",function(){window.location.reload()})}}else if(b.getResponseHeader("wa-session-expired"))window.location.reload();else typeof b.responseText!=="undefined"&&b.responseText.indexOf("Exception")!=
-1&&$.wa.dialogCreate("ajax-error",{content:"<div>"+b.responseText+"</div>"})});$.ajaxSetup({cache:false});$(document).ajaxSend(function(a,b,d){if(d.type=="POST"){a=(a=document.cookie.match(/(?:^|; )_csrf=([^;]*)/))?decodeURIComponent(a[1]):"";if(d.data===null)d.data="";if(typeof d.data=="string"){if(d.data.indexOf("_csrf=")==-1)d.data+=(d.data.length>0?"&":"")+"_csrf="+a}else if(typeof d.data=="object")d.data._csrf=a}});
if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a,b){var d=this.length,f=Number(b)||0;f=f<0?Math.ceil(f):Math.floor(f);if(f<0)f+=d;for(;f<d;f++)if(f in this&&this[f]===a)return f;return-1};$.wa.locale=$.wa.locale||{};
$_=function(a,b){if(b){if(!$.wa.locale[b]){console&&console.log("Localization failed: "+b);return b}if(typeof $.wa.locale[b]=="string")return $.wa.locale[b];var d=a%10;if(Math.floor(a/10)%10==1||d>4||d==0)return $.wa.locale[b][2];if(d==1)return $.wa.locale[b][0];return $.wa.locale[b][1]}if($.wa.locale[a])return typeof $.wa.locale[a]=="string"?$.wa.locale[a]:$.wa.locale[a][0];console&&console.log("Localization failed: "+a);return a};jQuery.JSON={useHasOwn:{}.hasOwnProperty?true:false,pad:function(a){return a<10?"0"+a:a},m:{"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},encodeString:function(a){if(/["\\\x00-\x1f]/.test(a))return'"'+a.replace(/([\x00-\x1f\\"])/g,function(b,d){var f=jQuery.JSON.m[d];if(f)return f;f=d.charCodeAt();return"\\u00"+Math.floor(f/16).toString(16)+(f%16).toString(16)})+'"';return'"'+a+'"'},encodeArray:function(a){var b=["["],d,f,e=a.length,c;for(f=0;f<e;f+=1){c=a[f];
switch(typeof c){case "undefined":case "function":case "unknown":break;default:d&&b.push(",");b.push(c===null?"null":this.encode(c));d=true}}b.push("]");return b.join("")},encodeDate:function(a){return'"'+a.getFullYear()+"-"+pad(a.getMonth()+1)+"-"+pad(a.getDate())+"T"+pad(a.getHours())+":"+pad(a.getMinutes())+":"+pad(a.getSeconds())+'"'},encode:function(a){if(typeof a=="undefined"||a===null)return"null";else if(a instanceof Array)return this.encodeArray(a);else if(a instanceof Date)return this.encodeDate(a);
else if(typeof a=="string")return this.encodeString(a);else if(typeof a=="number")return isFinite(a)?String(a):"null";else if(typeof a=="boolean")return String(a);else{var b=["{"],d,f,e;for(f in a)if(!this.useHasOwn||a.hasOwnProperty(f)){e=a[f];switch(typeof e){case "undefined":case "function":case "unknown":break;default:d&&b.push(",");b.push(this.encode(f),":",e===null?"null":this.encode(e));d=true}}b.push("}");return b.join("")}},decode:function(a){return eval("("+a+")")}};(function(a,b){a.store=function(d,f){var e=this;if(typeof d=="string")if(a.store.drivers[d])this.driver=a.store.drivers[d];else throw Error("Unknown driver "+d);else if(typeof d=="object"){if(!a.isFunction(d.init)||!a.isFunction(d.get)||!a.isFunction(d.set)||!a.isFunction(d.del)||!a.isFunction(d.flush))throw Error("The specified driver does not fulfill the API requirements");this.driver=d}else a.each(a.store.drivers,function(){if(!a.isFunction(this.available)||!this.available())return true;e.driver=
this;if(e.driver.init()===false){e.driver=null;return true}return false});if(!f)f=a.store.serializers;this.serializers={};a.each(f,function(c){if(!a.isFunction(this.init))return true;e.serializers[c]=this;e.serializers[c].init(e.encoders,e.decoders)})};a.extend(a.store.prototype,{get:function(d){d=this.driver.get(d);return this.driver.encodes?d:this.unserialize(d)},set:function(d,f){this.driver.set(d,this.driver.encodes?f:this.serialize(f))},del:function(d){this.driver.del(d)},flush:function(){this.driver.flush()},
driver:b,encoders:[],decoders:[],serialize:function(d){var f=this;a.each(this.encoders,function(){var e=f.serializers[this+""];if(!e||!e.encode)return true;try{d=e.encode(d)}catch(c){}});return d},unserialize:function(d){var f=this;if(!d)return d;a.each(this.decoders,function(){var e=f.serializers[this+""];if(!e||!e.decode)return true;d=e.decode(d)});return d}});a.store.drivers={localStorage:{ident:"$.store.drivers.localStorage",scope:"browser",available:function(){try{return!!window.localStorage}catch(d){return false}},
init:a.noop,get:function(d){return window.localStorage.getItem(d)},set:function(d,f){window.localStorage.setItem(d,f)},del:function(d){window.localStorage.removeItem(d)},flush:function(){window.localStorage.clear()}},userData:{ident:"$.store.drivers.userData",element:null,nodeName:"userdatadriver",scope:"browser",initialized:false,available:function(){try{return!!(document.documentElement&&document.documentElement.addBehavior)}catch(d){return false}},init:function(){if(!this.initialized)try{this.element=
document.createElement(this.nodeName);document.documentElement.insertBefore(this.element,document.getElementsByTagName("title")[0]);this.element.addBehavior("#default#userData");this.initialized=true}catch(d){return false}},get:function(d){this.element.load(this.nodeName);return this.element.getAttribute(d)},set:function(d,f){this.element.setAttribute(d,f);this.element.save(this.nodeName)},del:function(d){this.element.removeAttribute(d);this.element.save(this.nodeName)},flush:function(){this.element.expires=
(new Date).toUTCString();this.element.save(this.nodeName)}},windowName:{ident:"$.store.drivers.windowName",scope:"window",cache:{},encodes:true,available:function(){return true},init:function(){this.load()},save:function(){window.name=a.store.serializers.json.encode(this.cache)},load:function(){try{this.cache=a.store.serializers.json.decode(window.name+"");if(typeof this.cache!="object")this.cache={}}catch(d){this.cache={};window.name="{}"}},get:function(d){return this.cache[d]},set:function(d,f){this.cache[d]=
f;this.save()},del:function(d){try{delete this.cache[d]}catch(f){this.cache[d]=b}this.save()},flush:function(){window.name="{}"}}};a.store.serializers={json:{ident:"$.store.serializers.json",init:function(d,f){d.push("json");f.push("json")},encode:typeof JSON=="object"?JSON.stringify:a.JSON.stringify,decode:typeof JSON=="object"?JSON.parse:a.JSON.parse},xml:{ident:"$.store.serializers.xml",init:function(d,f){d.unshift("xml");f.push("xml")},isXML:function(d){return(d=(d?d.ownerDocument||d:0).documentElement)?
d.nodeName.toLowerCase()!=="html":false},encode:function(d){if(!d||d._serialized||!this.isXML(d))return d;var f={_serialized:this.ident,value:d};try{f.value=(new XMLSerializer).serializeToString(d);return f}catch(e){try{f.value=d.xml;return f}catch(c){}}return d},decode:function(d){if(!d||!d._serialized||d._serialized!=this.ident)return d;var f="DOMParser"in window&&(new DOMParser).parseFromString;if(!f&&window.ActiveXObject)f=function(e){var c=new ActiveXObject("Microsoft.XMLDOM");c.async="false";
c.loadXML(e);return c};if(!f)return b;d.value=f.call("DOMParser"in window&&new DOMParser||window,d.value,"text/xml");return this.isXML(d.value)?d.value:b}}}})(jQuery);(function(a){a.ui=a.ui||{};var b=/left|center|right/,d=/top|center|bottom/,f=a.fn.position,e=a.fn.offset;a.fn.position=function(c){if(!c||!c.of)return f.apply(this,arguments);c=a.extend({},c);var g=a(c.of),h=g[0],k=(c.collision||"flip").split(" "),j=c.offset?c.offset.split(" "):[0,0],l,o,r;if(h.nodeType===9){l=g.width();o=g.height();r={top:0,left:0}}else if(h.setTimeout){l=g.width();o=g.height();r={top:g.scrollTop(),left:g.scrollLeft()}}else if(h.preventDefault){c.at="left top";l=o=0;r={top:c.of.pageY,
left:c.of.pageX}}else{l=g.outerWidth();o=g.outerHeight();r=g.offset()}a.each(["my","at"],function(){var p=(c[this]||"").split(" ");if(p.length===1)p=b.test(p[0])?p.concat(["center"]):d.test(p[0])?["center"].concat(p):["center","center"];p[0]=b.test(p[0])?p[0]:"center";p[1]=d.test(p[1])?p[1]:"center";c[this]=p});if(k.length===1)k[1]=k[0];j[0]=parseInt(j[0],10)||0;if(j.length===1)j[1]=j[0];j[1]=parseInt(j[1],10)||0;if(c.at[0]==="right")r.left+=l;else if(c.at[0]==="center")r.left+=l/2;if(c.at[1]==="bottom")r.top+=
o;else if(c.at[1]==="center")r.top+=o/2;r.left+=j[0];r.top+=j[1];return this.each(function(){var p=a(this),n=p.outerWidth(),m=p.outerHeight(),q=parseInt(a.curCSS(this,"marginLeft",true))||0,u=parseInt(a.curCSS(this,"marginTop",true))||0,v=n+q+(parseInt(a.curCSS(this,"marginRight",true))||0),y=m+u+(parseInt(a.curCSS(this,"marginBottom",true))||0),s=a.extend({},r),w;if(c.my[0]==="right")s.left-=n;else if(c.my[0]==="center")s.left-=n/2;if(c.my[1]==="bottom")s.top-=m;else if(c.my[1]==="center")s.top-=
m/2;s.left=Math.round(s.left);s.top=Math.round(s.top);w={left:s.left-q,top:s.top-u};a.each(["left","top"],function(x,z){a.ui.position[k[x]]&&a.ui.position[k[x]][z](s,{targetWidth:l,targetHeight:o,elemWidth:n,elemHeight:m,collisionPosition:w,collisionWidth:v,collisionHeight:y,offset:j,my:c.my,at:c.at})});a.fn.bgiframe&&p.bgiframe();p.offset(a.extend(s,{using:c.using}))})};a.ui.position={fit:{left:function(c,g){var h=a(window);h=g.collisionPosition.left+g.collisionWidth-h.width()-h.scrollLeft();c.left=
h>0?c.left-h:Math.max(c.left-g.collisionPosition.left,c.left)},top:function(c,g){var h=a(window);h=g.collisionPosition.top+g.collisionHeight-h.height()-h.scrollTop();c.top=h>0?c.top-h:Math.max(c.top-g.collisionPosition.top,c.top)}},flip:{left:function(c,g){if(g.at[0]!=="center"){var h=a(window);h=g.collisionPosition.left+g.collisionWidth-h.width()-h.scrollLeft();var k=g.my[0]==="left"?-g.elemWidth:g.my[0]==="right"?g.elemWidth:0,j=g.at[0]==="left"?g.targetWidth:-g.targetWidth,l=-2*g.offset[0];c.left+=
g.collisionPosition.left<0?k+j+l:h>0?k+j+l:0}},top:function(c,g){if(g.at[1]!=="center"){var h=a(window);h=g.collisionPosition.top+g.collisionHeight-h.height()-h.scrollTop();var k=g.my[1]==="top"?-g.elemHeight:g.my[1]==="bottom"?g.elemHeight:0,j=g.at[1]==="top"?g.targetHeight:-g.targetHeight,l=-2*g.offset[1];c.top+=g.collisionPosition.top<0?k+j+l:h>0?k+j+l:0}}}};if(!a.offset.setOffset){a.offset.setOffset=function(c,g){if(/static/.test(a.curCSS(c,"position")))c.style.position="relative";var h=a(c),
k=h.offset(),j=parseInt(a.curCSS(c,"top",true),10)||0,l=parseInt(a.curCSS(c,"left",true),10)||0;k={top:g.top-k.top+j,left:g.left-k.left+l};"using"in g?g.using.call(c,k):h.css(k)};a.fn.offset=function(c){var g=this[0];if(!g||!g.ownerDocument)return null;if(c)return this.each(function(){a.offset.setOffset(this,c)});return e.call(this)}}})(jQuery);(function(a,b){var d={buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},f={maxHeight:true,maxWidth:true,minHeight:true,minWidth:true};a.widget("ui.dialog",{options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:{my:"center",at:"center",collision:"fit",using:function(e){var c=a(this).css(e).offset().top;c<0&&
a(this).css("top",e.top-c)}},resizable:true,show:null,stack:true,title:"",width:300,zIndex:1E3},_create:function(){this.originalTitle=this.element.attr("title");if(typeof this.originalTitle!=="string")this.originalTitle="";this.options.title=this.options.title||this.originalTitle;var e=this,c=e.options,g=c.title||"&#160;",h=a.ui.dialog.getTitleId(e.element),k=(e.uiDialog=a("<div></div>")).appendTo(document.body).hide().addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+c.dialogClass).css({zIndex:c.zIndex}).attr("tabIndex",
-1).css("outline",0).keydown(function(o){if(c.closeOnEscape&&o.keyCode&&o.keyCode===a.ui.keyCode.ESCAPE){e.close(o);o.preventDefault()}}).attr({role:"dialog","aria-labelledby":h}).mousedown(function(o){e.moveToTop(false,o)});e.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(k);var j=(e.uiDialogTitlebar=a("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(k),l=a('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role",
"button").hover(function(){l.addClass("ui-state-hover")},function(){l.removeClass("ui-state-hover")}).focus(function(){l.addClass("ui-state-focus")}).blur(function(){l.removeClass("ui-state-focus")}).click(function(o){e.close(o);return false}).appendTo(j);(e.uiDialogTitlebarCloseText=a("<span></span>")).addClass("ui-icon ui-icon-closethick").text(c.closeText).appendTo(l);a("<span></span>").addClass("ui-dialog-title").attr("id",h).html(g).prependTo(j);if(a.isFunction(c.beforeclose)&&!a.isFunction(c.beforeClose))c.beforeClose=
c.beforeclose;j.find("*").add(j).disableSelection();c.draggable&&a.fn.draggable&&e._makeDraggable();c.resizable&&a.fn.resizable&&e._makeResizable();e._createButtons(c.buttons);e._isOpen=false;a.fn.bgiframe&&k.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){this.overlay&&this.overlay.destroy();this.uiDialog.hide();this.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");this.uiDialog.remove();
this.originalTitle&&this.element.attr("title",this.originalTitle);return this},widget:function(){return this.uiDialog},close:function(e){var c=this,g,h;if(false!==c._trigger("beforeClose",e)){c.overlay&&c.overlay.destroy();c.uiDialog.unbind("keypress.ui-dialog");c._isOpen=false;if(c.options.hide)c.uiDialog.hide(c.options.hide,function(){c._trigger("close",e)});else{c.uiDialog.hide();c._trigger("close",e)}a.ui.dialog.overlay.resize();if(c.options.modal){g=0;a(".ui-dialog").each(function(){if(this!==
c.uiDialog[0]){h=a(this).css("z-index");isNaN(h)||(g=Math.max(g,h))}});a.ui.dialog.maxZ=g}return c}},isOpen:function(){return this._isOpen},moveToTop:function(e,c){var g=this.options;if(g.modal&&!e||!g.stack&&!g.modal)return this._trigger("focus",c);if(g.zIndex>a.ui.dialog.maxZ)a.ui.dialog.maxZ=g.zIndex;if(this.overlay){a.ui.dialog.maxZ+=1;this.overlay.$el.css("z-index",a.ui.dialog.overlay.maxZ=a.ui.dialog.maxZ)}e={scrollTop:this.element.attr("scrollTop"),scrollLeft:this.element.attr("scrollLeft")};
a.ui.dialog.maxZ+=1;this.uiDialog.css("z-index",a.ui.dialog.maxZ);this.element.attr(e);this._trigger("focus",c);return this},open:function(){if(!this._isOpen){var e=this.options,c=this.uiDialog;this.overlay=e.modal?new a.ui.dialog.overlay(this):null;this._size();this._position(e.position);c.show(e.show);this.moveToTop(true);e.modal&&c.bind("keypress.ui-dialog",function(g){if(g.keyCode===a.ui.keyCode.TAB){var h=a(":tabbable",this),k=h.filter(":first");h=h.filter(":last");if(g.target===h[0]&&!g.shiftKey){k.focus(1);
return false}else if(g.target===k[0]&&g.shiftKey){h.focus(1);return false}}});a(this.element.find(":tabbable").get().concat(c.find(".ui-dialog-buttonpane :tabbable").get().concat(c.get()))).eq(0).focus();this._isOpen=true;this._trigger("open");return this}},_createButtons:function(e){var c=this,g=false,h=a("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),k=a("<div></div>").addClass("ui-dialog-buttonset").appendTo(h);c.uiDialog.find(".ui-dialog-buttonpane").remove();
typeof e==="object"&&e!==null&&a.each(e,function(){return!(g=true)});if(g){a.each(e,function(j,l){l=a.isFunction(l)?{click:l,text:j}:l;j=a('<button type="button"></button>').attr(l,true).unbind("click").click(function(){l.click.apply(c.element[0],arguments)}).appendTo(k);a.fn.button&&j.button()});h.appendTo(c.uiDialog)}},_makeDraggable:function(){function e(j){return{position:j.position,offset:j.offset}}var c=this,g=c.options,h=a(document),k;c.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",
handle:".ui-dialog-titlebar",containment:"document",start:function(j,l){k=g.height==="auto"?"auto":a(this).height();a(this).height(a(this).height()).addClass("ui-dialog-dragging");c._trigger("dragStart",j,e(l))},drag:function(j,l){c._trigger("drag",j,e(l))},stop:function(j,l){g.position=[l.position.left-h.scrollLeft(),l.position.top-h.scrollTop()];a(this).removeClass("ui-dialog-dragging").height(k);c._trigger("dragStop",j,e(l));a.ui.dialog.overlay.resize()}})},_makeResizable:function(e){function c(j){return{originalPosition:j.originalPosition,
originalSize:j.originalSize,position:j.position,size:j.size}}e=e===b?this.options.resizable:e;var g=this,h=g.options,k=g.uiDialog.css("position");e=typeof e==="string"?e:"n,e,s,w,se,sw,ne,nw";g.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:g.element,maxWidth:h.maxWidth,maxHeight:h.maxHeight,minWidth:h.minWidth,minHeight:g._minHeight(),handles:e,start:function(j,l){a(this).addClass("ui-dialog-resizing");g._trigger("resizeStart",j,c(l))},resize:function(j,l){g._trigger("resize",
j,c(l))},stop:function(j,l){a(this).removeClass("ui-dialog-resizing");h.height=a(this).height();h.width=a(this).width();g._trigger("resizeStop",j,c(l));a.ui.dialog.overlay.resize()}}).css("position",k).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var e=this.options;return e.height==="auto"?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(e){var c=[],g=[0,0],h;if(e){if(typeof e==="string"||typeof e==="object"&&"0"in e){c=e.split?e.split(" "):
[e[0],e[1]];if(c.length===1)c[1]=c[0];a.each(["left","top"],function(k,j){if(+c[k]===c[k]){g[k]=c[k];c[k]=j}});e={my:c.join(" "),at:c.join(" "),offset:g.join(" ")}}e=a.extend({},a.ui.dialog.prototype.options.position,e)}else e=a.ui.dialog.prototype.options.position;(h=this.uiDialog.is(":visible"))||this.uiDialog.show();this.uiDialog.css({top:0,left:0}).position(a.extend({of:window},e));h||this.uiDialog.hide()},_setOptions:function(e){var c=this,g={},h=false;a.each(e,function(k,j){c._setOption(k,j);
if(k in d)h=true;if(k in f)g[k]=j});h&&this._size();this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",g)},_setOption:function(e,c){var g=this.uiDialog;switch(e){case "beforeclose":e="beforeClose";break;case "buttons":this._createButtons(c);break;case "closeText":this.uiDialogTitlebarCloseText.text(""+c);break;case "dialogClass":g.removeClass(this.options.dialogClass).addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+c);break;case "disabled":c?g.addClass("ui-dialog-disabled"):
g.removeClass("ui-dialog-disabled");break;case "draggable":var h=g.is(":data(draggable)");h&&!c&&g.draggable("destroy");!h&&c&&this._makeDraggable();break;case "position":this._position(c);break;case "resizable":(h=g.is(":data(resizable)"))&&!c&&g.resizable("destroy");h&&typeof c==="string"&&g.resizable("option","handles",c);!h&&c!==false&&this._makeResizable(c);break;case "title":a(".ui-dialog-title",this.uiDialogTitlebar).html(""+(c||"&#160;"))}a.Widget.prototype._setOption.apply(this,arguments)},
_size:function(){var e=this.options,c,g,h=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0});if(e.minWidth>e.width)e.width=e.minWidth;c=this.uiDialog.css({height:"auto",width:e.width}).height();g=Math.max(0,e.minHeight-c);if(e.height==="auto")if(a.support.minHeight)this.element.css({minHeight:g,height:"auto"});else{this.uiDialog.show();e=this.element.css("height","auto").height();h||this.uiDialog.hide();this.element.height(Math.max(e,g))}else this.element.height(Math.max(e.height-
c,0));this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}});a.extend(a.ui.dialog,{version:"1.8.9",uuid:0,maxZ:0,getTitleId:function(e){e=e.attr("id");if(!e){this.uuid+=1;e=this.uuid}return"ui-dialog-title-"+e},overlay:function(e){this.$el=a.ui.dialog.overlay.create(e)}});a.extend(a.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:a.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(e){return e+".dialog-overlay"}).join(" "),
create:function(e){if(this.instances.length===0){setTimeout(function(){a.ui.dialog.overlay.instances.length&&a(document).bind(a.ui.dialog.overlay.events,function(g){if(a(g.target).zIndex()<a.ui.dialog.overlay.maxZ)return false})},1);a(document).bind("keydown.dialog-overlay",function(g){if(e.options.closeOnEscape&&g.keyCode&&g.keyCode===a.ui.keyCode.ESCAPE){e.close(g);g.preventDefault()}});a(window).bind("resize.dialog-overlay",a.ui.dialog.overlay.resize)}var c=(this.oldInstances.pop()||a("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),
height:this.height()});a.fn.bgiframe&&c.bgiframe();this.instances.push(c);return c},destroy:function(e){var c=a.inArray(e,this.instances);c!=-1&&this.oldInstances.push(this.instances.splice(c,1)[0]);this.instances.length===0&&a([document,window]).unbind(".dialog-overlay");e.remove();var g=0;a.each(this.instances,function(){g=Math.max(g,this.css("z-index"))});this.maxZ=g},height:function(){var e,c;if(a.browser.msie&&a.browser.version<7){e=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);
c=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);return e<c?a(window).height()+"px":e+"px"}else return a(document).height()+"px"},width:function(){var e,c;if(a.browser.msie&&a.browser.version<7){e=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);c=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);return e<c?a(window).width()+"px":e+"px"}else return a(document).width()+"px"},resize:function(){var e=a([]);a.each(a.ui.dialog.overlay.instances,
function(){e=e.add(this)});e.css({width:0,height:0}).css({width:a.ui.dialog.overlay.width(),height:a.ui.dialog.overlay.height()})}});a.extend(a.ui.dialog.overlay.prototype,{destroy:function(){a.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);(function(a){var b=0,d=0;a.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:false,cookie:null,collapsible:false,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:'<li><a href="#{href}"><span>#{label}</span></a></li>'},_create:function(){this._tabify(true)},_setOption:function(f,e){if(f=="selected")this.options.collapsible&&e==this.options.selected||
this.select(e);else{this.options[f]=e;this._tabify()}},_tabId:function(f){return f.title&&f.title.replace(/\s/g,"_").replace(/[^A-Za-z0-9\-_:\.]/g,"")||this.options.idPrefix+ ++b},_sanitizeSelector:function(f){return f.replace(/:/g,"\\:")},_cookie:function(){var f=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+ ++d);return a.cookie.apply(null,[f].concat(a.makeArray(arguments)))},_ui:function(f,e){return{tab:f,panel:e,index:this.anchors.index(f)}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var f=
a(this);f.html(f.data("label.tabs")).removeData("label.tabs")})},_tabify:function(f){function e(n,m){n.css({display:""});!a.support.opacity&&m.opacity&&n[0].style.removeAttribute("filter")}this.list=this.element.find("ol,ul").eq(0);this.lis=a("li:has(a[href])",this.list);this.anchors=this.lis.map(function(){return a("a",this)[0]});this.panels=a([]);var c=this,g=this.options,h=/^#.+/;this.anchors.each(function(n,m){var q=a(m).attr("href"),u=q.split("#")[0],v;if(u&&(u===location.toString().split("#")[0]||
(v=a("base")[0])&&u===v.href)){q=m.hash;m.href=q}if(h.test(q))c.panels=c.panels.add(c._sanitizeSelector(q));else if(q!="#"){a.data(m,"href.tabs",q);a.data(m,"load.tabs",q.replace(/#.*$/,""));q=c._tabId(m);m.href="#"+q;m=a("#"+q);if(!m.length){m=a(g.panelTemplate).attr("id",q).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(c.panels[n-1]||c.list);m.data("destroy.tabs",true)}c.panels=c.panels.add(m)}else g.disabled.push(n)});if(f){this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all");
this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.lis.addClass("ui-state-default ui-corner-top");this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom");if(g.selected===undefined){location.hash&&this.anchors.each(function(n,m){if(m.hash==location.hash){g.selected=n;return false}});if(typeof g.selected!="number"&&g.cookie)g.selected=parseInt(c._cookie(),10);if(typeof g.selected!="number"&&this.lis.filter(".ui-tabs-selected").length)g.selected=
this.lis.index(this.lis.filter(".ui-tabs-selected"));g.selected=g.selected||(this.lis.length?0:-1)}else if(g.selected===null)g.selected=-1;g.selected=g.selected>=0&&this.anchors[g.selected]||g.selected<0?g.selected:0;g.disabled=a.unique(g.disabled.concat(a.map(this.lis.filter(".ui-state-disabled"),function(n){return c.lis.index(n)}))).sort();a.inArray(g.selected,g.disabled)!=-1&&g.disabled.splice(a.inArray(g.selected,g.disabled),1);this.panels.addClass("ui-tabs-hide");this.lis.removeClass("ui-tabs-selected ui-state-active");
if(g.selected>=0&&this.anchors.length){this.panels.eq(g.selected).removeClass("ui-tabs-hide");this.lis.eq(g.selected).addClass("ui-tabs-selected ui-state-active");c.element.queue("tabs",function(){c._trigger("show",null,c._ui(c.anchors[g.selected],c.panels[g.selected]))});this.load(g.selected)}a(window).bind("unload",function(){c.lis.add(c.anchors).unbind(".tabs");c.lis=c.anchors=c.panels=null})}else g.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));this.element[g.collapsible?"addClass":
"removeClass"]("ui-tabs-collapsible");g.cookie&&this._cookie(g.selected,g.cookie);f=0;for(var k;k=this.lis[f];f++)a(k)[a.inArray(f,g.disabled)!=-1&&!a(k).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled");g.cache===false&&this.anchors.removeData("cache.tabs");this.lis.add(this.anchors).unbind(".tabs");if(g.event!="mouseover"){var j=function(n,m){m.is(":not(.ui-state-disabled)")&&m.addClass("ui-state-"+n)};this.lis.bind("mouseover.tabs",function(){j("hover",a(this))});this.lis.bind("mouseout.tabs",
function(){a(this).removeClass("ui-state-hover")});this.anchors.bind("focus.tabs",function(){j("focus",a(this).closest("li"))});this.anchors.bind("blur.tabs",function(){a(this).closest("li").removeClass("ui-state-focus")})}var l,o;if(g.fx)if(a.isArray(g.fx)){l=g.fx[0];o=g.fx[1]}else l=o=g.fx;var r=o?function(n,m){a(n).closest("li").addClass("ui-tabs-selected ui-state-active");m.hide().removeClass("ui-tabs-hide").animate(o,o.duration||"normal",function(){e(m,o);c._trigger("show",null,c._ui(n,m[0]))})}:
function(n,m){a(n).closest("li").addClass("ui-tabs-selected ui-state-active");m.removeClass("ui-tabs-hide");c._trigger("show",null,c._ui(n,m[0]))},p=l?function(n,m){m.animate(l,l.duration||"normal",function(){c.lis.removeClass("ui-tabs-selected ui-state-active");m.addClass("ui-tabs-hide");e(m,l);c.element.dequeue("tabs")})}:function(n,m){c.lis.removeClass("ui-tabs-selected ui-state-active");m.addClass("ui-tabs-hide");c.element.dequeue("tabs")};this.anchors.bind(g.event+".tabs",function(){var n=this,
m=a(this).closest("li"),q=c.panels.filter(":not(.ui-tabs-hide)"),u=a(c._sanitizeSelector(this.hash));if(m.hasClass("ui-tabs-selected")&&!g.collapsible||m.hasClass("ui-state-disabled")||m.hasClass("ui-state-processing")||c._trigger("select",null,c._ui(this,u[0]))===false){this.blur();return false}g.selected=c.anchors.index(this);c.abort();if(g.collapsible)if(m.hasClass("ui-tabs-selected")){g.selected=-1;g.cookie&&c._cookie(g.selected,g.cookie);c.element.queue("tabs",function(){p(n,q)}).dequeue("tabs");
this.blur();return false}else if(!q.length){g.cookie&&c._cookie(g.selected,g.cookie);c.element.queue("tabs",function(){r(n,u)});c.load(c.anchors.index(this));this.blur();return false}g.cookie&&c._cookie(g.selected,g.cookie);if(u.length){q.length&&c.element.queue("tabs",function(){p(n,q)});c.element.queue("tabs",function(){r(n,u)});c.load(c.anchors.index(this))}else throw"jQuery UI Tabs: Mismatching fragment identifier.";a.browser.msie&&this.blur()});this.anchors.bind("click.tabs",function(){return false})},
destroy:function(){var f=this.options;this.abort();this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs");this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.anchors.each(function(){var e=a.data(this,"href.tabs");if(e)this.href=e;var c=a(this).unbind(".tabs");a.each(["href","load","cache"],function(g,h){c.removeData(h+".tabs")})});this.lis.unbind(".tabs").add(this.panels).each(function(){a.data(this,
"destroy.tabs")?a(this).remove():a(this).removeClass("ui-state-default ui-corner-top ui-tabs-selected ui-state-active ui-state-hover ui-state-focus ui-state-disabled ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide")});f.cookie&&this._cookie(null,f.cookie);return this},add:function(f,e,c){if(c===undefined)c=this.anchors.length;var g=this,h=this.options;e=a(h.tabTemplate.replace(/#\{href\}/g,f).replace(/#\{label\}/g,e));f=!f.indexOf("#")?f.replace("#",""):this._tabId(a("a",e)[0]);e.addClass("ui-state-default ui-corner-top").data("destroy.tabs",
true);var k=a("#"+f);k.length||(k=a(h.panelTemplate).attr("id",f).data("destroy.tabs",true));k.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide");if(c>=this.lis.length){e.appendTo(this.list);k.appendTo(this.list[0].parentNode)}else{e.insertBefore(this.lis[c]);k.insertBefore(this.panels[c])}h.disabled=a.map(h.disabled,function(j){return j>=c?++j:j});this._tabify();if(this.anchors.length==1){h.selected=0;e.addClass("ui-tabs-selected ui-state-active");k.removeClass("ui-tabs-hide");
this.element.queue("tabs",function(){g._trigger("show",null,g._ui(g.anchors[0],g.panels[0]))});this.load(0)}this._trigger("add",null,this._ui(this.anchors[c],this.panels[c]));return this},remove:function(f){var e=this.options,c=this.lis.eq(f).remove(),g=this.panels.eq(f).remove();if(c.hasClass("ui-tabs-selected")&&this.anchors.length>1)this.select(f+(f+1<this.anchors.length?1:-1));e.disabled=a.map(a.grep(e.disabled,function(h){return h!=f}),function(h){return h>=f?--h:h});this._tabify();this._trigger("remove",
null,this._ui(c.find("a")[0],g[0]));return this},enable:function(f){var e=this.options;if(a.inArray(f,e.disabled)!=-1){this.lis.eq(f).removeClass("ui-state-disabled");e.disabled=a.grep(e.disabled,function(c){return c!=f});this._trigger("enable",null,this._ui(this.anchors[f],this.panels[f]));return this}},disable:function(f){var e=this.options;if(f!=e.selected){this.lis.eq(f).addClass("ui-state-disabled");e.disabled.push(f);e.disabled.sort();this._trigger("disable",null,this._ui(this.anchors[f],this.panels[f]))}return this},
select:function(f){if(typeof f=="string")f=this.anchors.index(this.anchors.filter("[href$="+f+"]"));else if(f===null)f=-1;if(f==-1&&this.options.collapsible)f=this.options.selected;this.anchors.eq(f).trigger(this.options.event+".tabs");return this},load:function(f){var e=this,c=this.options,g=this.anchors.eq(f)[0],h=a.data(g,"load.tabs");this.abort();if(!h||this.element.queue("tabs").length!==0&&a.data(g,"cache.tabs"))this.element.dequeue("tabs");else{this.lis.eq(f).addClass("ui-state-processing");
if(c.spinner){var k=a("span",g);k.data("label.tabs",k.html()).html(c.spinner)}this.xhr=a.ajax(a.extend({},c.ajaxOptions,{url:h,success:function(j,l){a(e._sanitizeSelector(g.hash)).html(j);e._cleanup();c.cache&&a.data(g,"cache.tabs",true);e._trigger("load",null,e._ui(e.anchors[f],e.panels[f]));try{c.ajaxOptions.success(j,l)}catch(o){}},error:function(j,l){e._cleanup();e._trigger("load",null,e._ui(e.anchors[f],e.panels[f]));try{c.ajaxOptions.error(j,l,f,g)}catch(o){}}}));e.element.dequeue("tabs");return this}},
abort:function(){this.element.queue([]);this.panels.stop(false,true);this.element.queue("tabs",this.element.queue("tabs").splice(-2,2));if(this.xhr){this.xhr.abort();delete this.xhr}this._cleanup();return this},url:function(f,e){this.anchors.eq(f).removeData("cache.tabs").data("load.tabs",e);return this},length:function(){return this.anchors.length}});a.extend(a.ui.tabs,{version:"1.8.2"});a.extend(a.ui.tabs.prototype,{rotation:null,rotate:function(f,e){var c=this,g=this.options,h=c._rotate||(c._rotate=
function(k){clearTimeout(c.rotation);c.rotation=setTimeout(function(){var j=g.selected;c.select(++j<c.anchors.length?j:0)},f);k&&k.stopPropagation()});e=c._unrotate||(c._unrotate=!e?function(k){k.clientX&&c.rotate(null)}:function(){t=g.selected;h()});if(f){this.element.bind("tabsshow",h);this.anchors.bind(g.event+".tabs",e);h()}else{clearTimeout(c.rotation);this.element.unbind("tabsshow",h);this.anchors.unbind(g.event+".tabs",e);delete this._rotate;delete this._unrotate}return this}})})(jQuery);(function(a){a.storage=new a.store;a.wa.errorHandler=function(b){a.storage.del("site/"+a.wa.site.domain+"/hash");if(b.status==404){a.wa.setHash("#/");return false}return true};a.wa.site={options:[],domain:0,helper:"",init:function(b){typeof a.History!="undefined"&&a.History.bind(function(){a.wa.site.dispatch()});this.domain=b.domain;this.options=b;b=window.location.hash;if(b==="#/"||!b)(b=a.storage.get("site/"+this.domain+"/hash"))&&b!=null?a.wa.setHash("#/"+b):this.dispatch();else a.wa.setHash(b)},
setHelper:function(b){if(b===true)return false;if(b){this.helper=b;a("#s-save-panel div.s-dropdown").show()}else{this.helper="";a("#s-save-panel div.s-dropdown").hide()}},dispatch:function(b){if(b==undefined)b=window.location.hash;if(b=b.replace(/^[^#]*#\/*/,"")){b=b.split("/");if(b[0]){for(var d="",f=b.length,e=0;e<b.length;e++){var c=b[e];if(e<2)if(e===0)d=c;else if(d=="files"){f=e;break}else if(parseInt(c,10)!=c&&c.indexOf("=")==-1)d+=c.substr(0,1).toUpperCase()+c.substr(1);else{f=e;break}else{f=
e;break}}f=b.slice(f);if(this[d+"Action"]){this[d+"Action"].apply(this,f);a.storage.set("site/"+this.domain+"/hash",b.join("/"))}else console&&console.log("Invalid action name:",d+"Action")}else this.defaultAction()}else this.defaultAction()},defaultAction:function(){var b=a("div.s-sidebar ul.s-links a:first").attr("href");a.wa.setHash(b)},pagesAction:function(b){var d=this.parseParams(b);a("#s-content").load("?module=pages",b+"&domain_id="+this.domain,function(){a(".s-scrollable-part").scrollTop(0);
a.wa.site.active(a("#page-"+d.id));a("#s-save-panel .s-bottom-fixed-bar-content-offset").addClass("s-page-editor");var f=a("div.s-editor").height()-a("div.s-editor .s-gray-toolbar").height()-132;if(a("#wa-app").height()<a("#wa").height()-a("#wa-header").height())f+=a("#wa").height()-a("#wa-header").height()-a("#wa-app").height();if(f<300)f=300;waEditorInit({id:"content",save_button:"s-editor-save-button",sortable:false,height:f})})},removePageCallback:function(b){return function(){var d=a("#page-"+
b),f=d.prev().length>0?d.prev().addClass("selected").find("a").attr("hash"):d.next().length>0?d.next().addClass("selected").find("a").attr("hash"):"/pages/add/";a.wa.setHash(f);d.remove()}},pagesAddAction:function(){this.pagesAction("id=")},filesAction:function(b,d){this.savePanel(false);if(b===true)var f=d||this.filesPath();else{f=Array.prototype.join.call(arguments,"/");b=false}var e=function(){a.wa.site.active(a("#s-link-files"));a("#s-files-tree li.selected").removeClass("selected");if(f){a("a.s-baseurl").removeClass("selected");
a("#s-folder-actions-li").show();var c=a("#s-files-tree a[href='#/files/"+f+"']");c.parent().addClass("selected");for(c=c.parent();c.length;){var g=c.find("> i.overhanging");g.hasClass("rarr")&&g.click();c=c.parent("ul").parent("li")}}else{a("#s-folder-actions-li").hide();a("a.s-baseurl").addClass("selected")}a.wa.site.filesList(f);a("#s-upload-path").val(f||"");a("#s-current-path").html("/"+(f||""));a("#s-files-count").html("0");a("#s-files-grid input.all").removeAttr("checked")};a("#s-files-tree").length&&
!b?e():a("#s-content").load("?module=files","domain_id="+this.domain,function(){a(".s-scrollable-part").scrollTop(0);a("#s-files-tree i.overhanging").click(function(){var c=a(this);c.hasClass("rarr")?c.removeClass("rarr").addClass("darr").parent().children("ul").show():c.removeClass("darr").addClass("rarr").parent().children("ul").hide()});b===true&&d?a.wa.setHash("#/files/"+d):e()})},filesList:function(b){b||(b=this.filesPath());a.post("?module=files&action=list",{path:b},function(d){a("#s-files-grid tr.s-file").remove();
for(var f=0;f<d.data.length;f++){var e='<tr class="s-file"><td class="min-width"><input type="checkbox" value="'+d.data[f].file+'" /></td><td><ul class="menu-h dropdown clickable"><li><a href="#"><i class="icon16 '+d.data[f].type+'"></i> '+d.data[f].file+' <i class="icon10 darr no-overhanging s-file-actions"></i></a></li></ul></td><td>'+d.data[f].datetime+'</td><td><span class="float-right">'+a.wa.site.getFileSize(d.data[f].size)+"</span></td></tr>";a("#s-files-grid").append(e)}},"json")},getFileSize:function(b){return b<
1024?b+" B":b<1048576?Math.round(b/1024)+" KB":b<1073741824?Math.round(b/1048576)+" MB":Math.round(b/1073741824)+" GB"},checkFileType:function(b){return b=="image"||b=="text"||b=="script-css"||b=="script-js"},getFileMenu:function(b){var d=a("#s-domain").attr("href")+"wa-data/public/site/"+a.wa.site.filesPath()+b,f=a('<ul class="menu-v width-icons" style="display:block"></ul>');b.substr(-4)!=".php"&&b.substr(-6)!=".phtml"&&b.substr(0,1)!="."&&f.append('<li><i class="icon16 globe"></i>'+$_("File URL")+
': <a href="'+d+'" target="_blank" class="bold">'+d+'<i class="icon10 new-window"></i></a></li>');b.substr(-4)!=".php"&&b.substr(-6)!=".phtml"&&f.append('<li><a href="?module=files&action=download&path='+a.wa.site.filesPath()+"&file="+b+'"><i class="icon16 download"></i>'+$_("Download")+"</a></li>");f.append(a("<li></li>").append('<a href="#"><i class="icon16 edit"></i>'+$_("Rename")+"</a>").click(function(){a("#s-rename-dialog").waDialog({disableButtonsOnSubmit:true,onLoad:function(){a("#s-name").val(b).focus().select();
a(this).find("span").html(a.wa.site.filesPath(true))},onSubmit:function(){var e=a("#s-name").val();a.post("?module=files&action=rename",{path:a.wa.site.filesPath(),name:e,file:b},function(c){if(c.status=="ok"){a.wa.site.filesList();a("#s-rename-dialog").hide()}else if(c.status=="fail"){alert(c.errors);a("#s-rename-dialog input[type=submit]").removeAttr("disabled")}},"json");return false}});return false}));f.append(a("<li></li>").append('<a href="#"><i class="icon16 move"></i>'+$_("Move to folder")+
"</a>").click(function(){a("#s-move-dialog select").html(a.wa.site.filesPathOptions(a("#s-files-tree > ul.s-folderlist"),""));a("#s-move-dialog-files").html('<input type="hidden" name="file" value="'+b+'" />');a("#s-move-dialog input[name=path]").val(a.wa.site.filesPath());a("#s-move-dialog h1 span").empty();a("#s-move-dialog").waDialog({disableButtonsOnSubmit:true,onSubmit:function(){a.post("?module=files&action=move",a("#s-move-dialog form").serialize(),function(e){if(e.status=="ok"){a("#s-move-dialog").hide();
a.wa.site.filesList()}else if(e.status=="fail"){alert(e.errors);a("#s-move-dialog input[type=submit]").removeAttr("disabled")}},"json");return false}});return false}));f.append(a("<li></li>").append('<a href="#"><i class="icon16 delete"></i>'+$_("Delete")+"</a>").click(function(){a("#s-delete-dialog").waDialog({content:"<h1>"+$_("Delete file")+"</h1><p>"+$_("File")+" <b>"+b+"</b> "+$_("will be deleted without the ability to recover.")+"</p>",disableButtonsOnSubmit:true,onSubmit:function(){a.post("?module=files&action=delete",
{path:a.wa.site.filesPath(),file:b},function(e){if(e.status=="ok"){a.wa.site.filesList();a("#s-delete-dialog").hide()}else if(e.status=="fail"){alert(e.errors);a("#s-delete-dialog input[type=submit]").removeAttr("disabled")}},"json")}});return false}));return f},settingsAction:function(b){this.savePanel(false);if(a("#s-settings-tabs").length){var d=b?a("#s-settings-tabs a[href='#"+b+"']"):a("#s-settings-tabs a:last");d.parent().hasClass("selected")||d.click();a.wa.site.active(b!="routing"?a("a#s-settings-link"):
false)}else a("#s-content").load("?module=settings&domain_id="+this.domain,function(){b?a("#s-settings-tabs a[href='#"+b+"']").click():a("#s-settings-tabs a:last").click();a.wa.site.active(b!="routing"?a("a#s-settings-link"):false)})},settingsRoutingAction:function(){this.settingsAction("routing")},snippetsAction:function(b){a("#s-content").load("?module=snippets",b,function(){a(".s-scrollable-part").scrollTop(0);a.wa.site.initEditor("content","app=");a.wa.site.active(a("#s-link-snippets"))})},snippetsAddAction:function(){this.snippetsAction("id=")},
themesAction:function(b){this.savePanel(false);a("#s-content").load("?module=themes",b,function(){a(".s-scrollable-part").scrollTop(0);a.wa.site.active(a("#s-link-themes"))})},designAction:function(b){var d=this.parseParams(b);a("#s-content").load("?module=design",b+"&domain_id="+this.domain,function(){a(".s-scrollable-part").scrollTop(0);a.wa.site.initEditor("content",true);a.wa.site.active(a("#design-"+d.route));a("ul.s-theme li.selected").removeClass("selected");if(d.file==="")a("#theme-"+d.theme+
" li.add-file").addClass("selected");else if(d.file)a("#theme-"+d.theme+" li[data-file='"+d.file+"']").addClass("selected");else if(d.theme)a("#theme-"+d.theme+" li:first").addClass("selected");else a("ul.s-theme:first li[data-file='index.html']").length>0?a("ul.s-theme:first li[data-file='index.html']").addClass("selected"):a("ul.s-theme:first li:first").addClass("selected")})},active:function(b){a(".sidebar a.selected").removeClass("selected");a("ul.s-links li.selected").removeClass("selected");
b&&b.length&&b.addClass("selected")},routingAction:function(b){this.savePanel(false);a("#s-content").load("?module=routing",b+"&domain_id="+this.domain,function(){})},parseParams:function(b){if(!b)return{};b=b.split("&");var d={};for(i=0;i<b.length;i++){var f=b[i].split("=");d[f[0]]=f.length>1?f[1]:""}return d},designAddAction:function(b){this.designAction(b+"&file=")},initEditor:function(b,d){if(!a("#"+b).length)return false;var f=a("#"+b).attr("data-type");this.savePanel(true);var e=a("div.s-editor.s-white").height()-
a("div.s-editor.s-white .s-grey-toolbar").height()-50;if(e<300)e=300;wa_editor=CodeMirror.fromTextArea(document.getElementById(b),{mode:f?"text/"+f:"text/html",tabMode:"indent",height:"dynamic",lineWrapping:true,onKeyEvent:function(c,g){var h=jQuery.Event(g);if(h.type=="keydown")waEditorKeyCallback(false,{save_button:"s-editor-save-button"})(g);else{h.type="keypress";waEditorKeyCallback(true,{save_button:"s-editor-save-button"})(g)}}});a(".CodeMirror-scroll").css("min-height",e+"px");this.setHelper(d||
false)},savePanel:function(b){if(b){a("#s-save-panel").show();a("#s-save-panel .s-bottom-fixed-bar-content-offset").removeClass("s-page-editor");a("#wa div.s-scrollable-part").removeClass("s-no-editor");a("#s-editor-save-button").removeClass("yellow").addClass("green");a("#process-message").empty()}else{a("#s-save-panel").hide();a("#wa div.s-scrollable-part").addClass("s-no-editor")}},getTreeHTML:function(b,d,f){f=f||"";d="<ul"+(d?"":' style="display:none"')+' class="menu-v with-icons'+(d?" "+d:"")+
'">';for(var e="",c=0;c<b.length;c++){e=typeof b[c]=="string"?b[c]:b[c].id;d+="<li>";if(typeof b[c]!="string")d+='<i class="icon16 rarr overhanging"></i>';d+='<a href="#/files/'+f+e+'/"><i class="icon16 folder"></i><b>'+e+"</b></a>";if(typeof b[c]!="string")d+=this.getTreeHTML(b[c].childs,false,f+e+"/");d+="</li>"}d+="</ul>";return d},filesPath:function(b){b=b?"wa-data/public/site/":"";if(a("#s-files-tree li.selected").length)return b+a("#s-files-tree li.selected a").attr("href").substr(8);return b},
filesPathOptions:function(b,d,f){d=d||"";var e="";if(d==""){e='<option value="">wa-data/public/site</a>';d="&nbsp;&nbsp;&nbsp;"}f=f||false;b.children("li").each(function(){var c=f&&a(this).find("> ul > li.selected").length||!f&&a(this).hasClass("selected")?true:false,g=a(this).children("a");e+="<option "+(c?'selected="selected"':"")+' value="'+g.attr("href").substr(8)+'">'+d+g.children("b").html()+"</option>";if(a(this).children("ul").length&&(!f||!a(this).hasClass("selected")))e+=a.wa.site.filesPathOptions(a(this).children("ul"),
d+"&nbsp;&nbsp;&nbsp;",f)});return e}}})(jQuery);
$(function(){$(".s-add-new-site").live("click",function(){$("#addsite-dialog").waDialog({onSubmit:function(){var a=$(this);$.post(a.attr("action"),a.serialize(),function(b){if(b.status=="ok")location.href="?domain_id="+b.data.id+"#/settings/"},"json");return false}});return false});$("div.s-sidebar h5.heading").click(function(){var a=$(this);if(a.find("i").hasClass("darr")){a.find("i").removeClass("darr").addClass("rarr");a.next("ul").hide();$.storage.set("site/"+$.wa.site.domain+"/"+a.attr("data-hash"),
1)}else{a.find("i").removeClass("rarr").addClass("darr");a.next("ul").show();$.storage.del("site/"+$.wa.site.domain+"/"+a.attr("data-hash"))}});$("div.s-sidebar h5.heading").each(function(){$.storage.get("site/"+$.wa.site.domain+"/"+$(this).attr("data-hash"))&&$(this).click()});$("#s-pages").sortable({distance:5,helper:"clone",items:"li",opacity:0.75,tolerance:"pointer",stop:function(a,b){var d=$(b.item),f=d.attr("id").replace(/page-/,"");d=d.prevAll("li").size()+1;$.post("?module=pages&action=sort&domain_id="+
$.wa.site.domain,{id:f,pos:d},function(){},"json")}});$("#s-page-settings-toggle").live("click",function(){$("#s-page-settings").toggle();return false});$("#s-editor-save-button").click(function(){$("#site-form").submit()});$("#s-domains-menu h1").click(function(){var a=$("#s-domains-menu ul.menu-v");if(a.is(":visible")){a.hide();return false}a.show();$(document).one("click",function(){a.hide()});return false});$("#s-helper-link").click(function(){if($("#s-helper").is(":visible")){$("#s-helper").hide();
return false}$("#s-helper").load("?module=helper",$.wa.site.helper,function(){$(this).show();var a=function(b){$(b.target).attr("id")=="s-helper"||$(b.target).parents("#s-helper").length?$(document).one("click",a):$("#s-helper").hide()};$(document).one("click",a)});return false});$("#s-helper div.fields a.inline-link").live("click",function(){var a=$(this).find("i");if(a.children("b").length)a=a.children("b");if($(".el-rte").length&&$(".el-rte").is(":visible"))try{$("#content").elrte()[0].elrte.selection.insertHtml(a.text())}catch(b){}else wa_editor.replaceSelection(a.text());
return false});$("#wa-app > div.s-sidebar a, #wa-header a, #s-content > div.sidebar a").live("click",function(){if($("#s-save-panel").is(":visible")&&$("#s-editor-save-button").hasClass("yellow"))return confirm($_("Unsaved changes will be lost if you leave this page now. Are you sure?"))});$("#site-form").live("submit",function(){waEditorUpdateSource({id:"content"});var a=$(this);$("#process-message").html("<i class='icon16 loading'></i> "+$_("Saving...")).fadeIn("slow");$.post(a.attr("action"),a.serialize(),
function(b){if(b.status=="ok"){$(".error").removeClass("error");$("#process-message").html('<i class="icon16 yes"></i>'+$_("Saved")).fadeOut("slow");$("#s-editor-save-button").removeClass("yellow").removeClass("red").addClass("green");a.trigger("response",[b])}else if(b.status=="fail"){if($.isArray(b.errors)){var d=b.errors[0];$(b.errors[1]).addClass("error")}else d=b.errors;$("#process-message").html('<b style="color:red">'+(d?d:$_("An error occurred while saving"))+"</b>");$("#s-editor-save-button").removeClass("yellow").removeClass("green").addClass("red")}},
"json");$(".el-rte").length&&$(".el-rte").is(":visible");return false})});
